From 3568cd79c9cc01b2b1f680b8aa906a1f8e7f0a2e Mon Sep 17 00:00:00 2001
From: Vivek Kumbhar <vkumbhar@mvista.com>
Date: Fri, 5 Jul 2024 02:54:09 +0000
Subject: [PATCH] CVE-2020-23922

---
 util/gif2rgb.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/util/gif2rgb.c b/util/gif2rgb.c
index e39f37b..09f09bb 100644
--- a/util/gif2rgb.c
+++ b/util/gif2rgb.c
@@ -290,6 +290,11 @@ static void DumpScreen2RGB(char *FileName, int OneFileFlag,
             GifRow = ScreenBuffer[i];
             GifQprintf("\b\b\b\b%-4d", ScreenHeight - i);
             for (j = 0, BufferP = Buffer; j < ScreenWidth; j++) {
+                /* Check if color is within color palete */
+                if (GifRow[j] >= ColorMap->ColorCount)
+                {
+                   GIF_EXIT(GifErrorString(D_GIF_ERR_IMAGE_DEFECT));
+                }
                 ColorMapEntry = &ColorMap->Colors[GifRow[j]];
                 *BufferP++ = ColorMapEntry->Red;
                 *BufferP++ = ColorMapEntry->Green;
--
2.24.4
