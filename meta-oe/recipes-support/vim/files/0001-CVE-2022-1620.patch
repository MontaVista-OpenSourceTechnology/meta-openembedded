From 08027b24a455bd6d6943f5ec1dbee46f20d3a2e6 Mon Sep 17 00:00:00 2001
From: Hitendra Prajapati <hprajapati@mvista.com>
Date: Tue, 31 May 2022 10:39:39 +0530
Subject: [PATCH] CVE-2022-1620

Upstream-Status: Backport from https://github.com/vim/vim/commit/8e4b76da1d7e987d43ca960dfbc372d1c617466f

Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 src/buffer.c  | 2 +-
 src/version.c | 2 ++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/buffer.c b/src/buffer.c
index 8ee65375c..b620bf8d7 100644
--- a/src/buffer.c
+++ b/src/buffer.c
@@ -2800,7 +2800,7 @@ fname_match(
 	rmp->rm_ic = p_fic || ignore_case;
 	if (vim_regexec(rmp, name, (colnr_T)0))
 	    match = name;
-	else
+	else if (rmp->regprog != NULL)
 	{
 	    /* Replace $(HOME) with '~' and try matching again. */
 	    p = home_replace_save(NULL, name);
diff --git a/src/version.c b/src/version.c
index 071f24034..d572ecdd4 100644
--- a/src/version.c
+++ b/src/version.c
@@ -769,6 +769,8 @@ static char *(features[]) =
 
 static int included_patches[] =
 {   /* Add new patch number below this line */
+/**/
+    4901,
 /**/
     4899,
 /**/
-- 
2.25.1

