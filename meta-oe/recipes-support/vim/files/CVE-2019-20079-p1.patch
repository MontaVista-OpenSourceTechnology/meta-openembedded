From 9a3bd7bc74011b1d57f0b92f12d80a4446257b2b Mon Sep 17 00:00:00 2001
From: Milan Shah <mshah@mvista.com>
Date: Tue, 24 Mar 2020 11:29:18 +0530
Subject: [PATCH 1/4] mode is not cleared when leaving Insert mode with mapped
 Esc

Excluded changes of src/screen.c, src/testdir/test_messages.vim, src/version.c

Upstream-Status: Backport from [ https://github.com/vim/vim/commit/4c25bd785aa ]
CVE: CVE-2019-20079
Signed-off-by: Milan Shah <mshah@mvista.com>

diff --git a/src/globals.h b/src/globals.h
index fa5b493..720bc33 100644
--- a/src/globals.h
+++ b/src/globals.h
@@ -92,12 +92,13 @@ EXTERN int	mod_mask INIT(= 0x0);		/* current key modifiers */
  */
 EXTERN int	cmdline_row;
 
-EXTERN int	redraw_cmdline INIT(= FALSE);	/* cmdline must be redrawn */
-EXTERN int	clear_cmdline INIT(= FALSE);	/* cmdline must be cleared */
-EXTERN int	mode_displayed INIT(= FALSE);	/* mode is being displayed */
-EXTERN int	no_win_do_lines_ins INIT(= FALSE); /* don't insert lines */
+EXTERN int	redraw_cmdline INIT(= FALSE);	// cmdline must be redrawn
+EXTERN int	redraw_mode INIT(= FALSE);	// mode must be redrawn
+EXTERN int	clear_cmdline INIT(= FALSE);	// cmdline must be cleared
+EXTERN int	mode_displayed INIT(= FALSE);	// mode is being displayed
+EXTERN int	no_win_do_lines_ins INIT(= FALSE); // don't insert lines
 #if defined(FEAT_CRYPT) || defined(FEAT_EVAL)
-EXTERN int	cmdline_star INIT(= FALSE);	/* cmdline is crypted */
+EXTERN int	cmdline_star INIT(= FALSE);	// cmdline is crypted
 #endif
 
 EXTERN int	exec_from_reg INIT(= FALSE);	/* executing register */
-- 
2.7.4

