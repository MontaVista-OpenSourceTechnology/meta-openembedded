From 9851ac80fb9e1c0aaae9b52ed9aab2e8474161f6 Mon Sep 17 00:00:00 2001
From: Milan Shah <mshah@mvista.com>
Date: Tue, 24 Mar 2020 11:48:49 +0530
Subject: [PATCH 2/4] mode is not updated when switching to terminal

Excluded changes from src/testdir/test_window_cmd.vim, src/version.c

Upstream-Status: Backport from [ https://github.com/vim/vim/commit/a27e1dcddc9 ]
CVE: CVE-2019-20079
Signed-off-by: Milan Shah <mshah@mvista.com>

diff --git a/src/window.c b/src/window.c
index 5671cf9..3be5378 100644
--- a/src/window.c
+++ b/src/window.c
@@ -4457,6 +4457,9 @@ win_enter_ext(
     maketitle();
 #endif
     curwin->w_redr_status = TRUE;
+    if (bt_terminal(wp->w_buffer))
+	// terminal is likely in another mode
+	redraw_mode = TRUE;
     redraw_tabline = TRUE;
     if (restart_edit)
 	redraw_later(VALID);	/* causes status line redraw */
-- 
2.7.4

