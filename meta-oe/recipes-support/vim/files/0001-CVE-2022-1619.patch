From 51dfbdc2d57b70d8d875d45b21c5e8b8cfa14ca4 Mon Sep 17 00:00:00 2001
From: Hitendra Prajapati <hprajapati@mvista.com>
Date: Tue, 31 May 2022 10:36:24 +0530
Subject: [PATCH] CVE-2022-1619

Upstream-Status: Backport from https://github.com/vim/vim/commit/ef02f16609ff0a26ffc6e20263523424980898fe

Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 src/ex_getln.c               | 3 +++
 src/testdir/test_cmdline.vim | 3 +++
 src/version.c                | 2 ++
 3 files changed, 8 insertions(+)

diff --git a/src/ex_getln.c b/src/ex_getln.c
index 9bd33d11c..8dd317979 100644
--- a/src/ex_getln.c
+++ b/src/ex_getln.c
@@ -999,10 +999,13 @@ getcmdline(
 		    {
 			while (p > ccline.cmdbuff && vim_isspace(p[-1]))
 			    --p;
+			if (p > ccline.cmdbuff)
+			{
 			i = vim_iswordc(p[-1]);
 			while (p > ccline.cmdbuff && !vim_isspace(p[-1])
 				&& vim_iswordc(p[-1]) == i)
 			    --p;
+			}
 		    }
 		    else
 			--p;
diff --git a/src/testdir/test_cmdline.vim b/src/testdir/test_cmdline.vim
index 84e97f308..bfe5d88af 100644
--- a/src/testdir/test_cmdline.vim
+++ b/src/testdir/test_cmdline.vim
@@ -331,6 +331,9 @@ func Test_cmdline_remove_char()
 
     call feedkeys(":abc def\<S-Left>\<C-U>\<C-B>\"\<CR>", 'tx')
     call assert_equal('"def', @:, e)
+
+    " This was going before the start in latin1.
+    call feedkeys(": \<C-W>\<CR>", 'tx')
   endfor
 
   let &encoding = encoding_save
diff --git a/src/version.c b/src/version.c
index 988a536b2..071f24034 100644
--- a/src/version.c
+++ b/src/version.c
@@ -769,6 +769,8 @@ static char *(features[]) =
 
 static int included_patches[] =
 {   /* Add new patch number below this line */
+/**/
+    4899,
 /**/
     4895,
 /**/
-- 
2.25.1

