From 57afd14b4d887c3a2240113b91fdcef83c227456 Mon Sep 17 00:00:00 2001
From: Howard Chu <hyc@openldap.org>
Date: Sun, 20 Dec 2020 21:31:15 +0000
Subject: [PATCH 10/14] ITS#9428 fix cancel exop

Upstream Status: Backport https://git.openldap.org/openldap/openldap/-/commit/9d0e8485f3113505743baabf1167e01e4558ccf5
CVE: CVE-2020-36227

Signed-off-by: Anand Je Sypureddy <anandje@mvista.com>
---
 servers/slapd/cancel.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/servers/slapd/cancel.c b/servers/slapd/cancel.c
index ec5ef25..d8adcad 100644
--- a/servers/slapd/cancel.c
+++ b/servers/slapd/cancel.c
@@ -64,6 +64,11 @@ int cancel_extop( Operation *op, SlapReply *rs )
 		return LDAP_PROTOCOL_ERROR;
 	}
 
+	if ( opid == op->o_msgid ) {
+		op->o_cancel = SLAP_CANCEL_DONE;
+		return LDAP_SUCCESS;
+	}
+
 	ldap_pvt_thread_mutex_lock( &op->o_conn->c_mutex );
 
 	if ( op->o_abandon ) {
-- 
2.29.0

