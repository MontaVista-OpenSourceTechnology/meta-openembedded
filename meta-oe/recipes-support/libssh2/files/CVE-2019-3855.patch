Description: Possible integer overflow in transport read allows out-of-bounds write
Origin: upstream, https://libssh2.org/1.8.0-CVE/CVE-2019-3855.patch
Bug-Debian: https://bugs.debian.org/924965
Bug-Debian-Security: https://security-tracker.debian.org/tracker/CVE-2019-3855
Forwarded: not-needed
Last-Update: 2019-03-30

Upstream-Status: Backport [import from debian security.debian.org/debian-security/pool/updates/main/libs/libssh2/libssh2_1.8.0-2.1+deb10u1.debian.tar.xz
Upstream commit https://github.com/libssh2/libssh2/commit/9d50f8efce29232f1ff29d6af720f74643a9b65e]
CVE: CVE-2019-3855
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
--- a/src/transport.c
+++ b/src/transport.c
@@ -438,6 +438,12 @@ int _libssh2_transport_read(LIBSSH2_SESS
                 return LIBSSH2_ERROR_DECRYPT;
 
             p->padding_length = block[4];
+            if(p->packet_length < 1) {
+                return LIBSSH2_ERROR_DECRYPT;
+            }
+            else if(p->packet_length > LIBSSH2_PACKET_MAXPAYLOAD) {
+                return LIBSSH2_ERROR_OUT_OF_BOUNDARY;
+            }
 
             /* total_num is the number of bytes following the initial
                (5 bytes) packet length and padding length fields */
