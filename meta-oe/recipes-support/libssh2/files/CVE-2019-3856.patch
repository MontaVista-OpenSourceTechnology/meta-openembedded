Description: Possible integer overflow in keyboard interactive handling allows out-of-bounds write
Origin: upstream, https://libssh2.org/1.8.0-CVE/CVE-2019-3856.patch
Bug-Debian: https://bugs.debian.org/924965
Bug-Debian-Security: https://security-tracker.debian.org/tracker/CVE-2019-3856
Forwarded: not-needed
Last-Update: 2019-03-30

Upstream-Status: Backport [import from debian security.debian.org/debian-security/pool/updates/main/libs/libssh2/libssh2_1.8.0-2.1+deb10u1.debian.tar.xz
Upstream commit https://github.com/libssh2/libssh2/commit/b9fb79b6257dcd3d58baa028333c4817b782f0c4]
CVE: CVE-2019-3856
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
--- a/src/userauth.c
+++ b/src/userauth.c
@@ -1734,6 +1734,13 @@ userauth_keyboard_interactive(LIBSSH2_SE
             /* int       num-prompts */
             session->userauth_kybd_num_prompts = _libssh2_ntohu32(s);
             s += 4;
+            if(session->userauth_kybd_num_prompts && 
+               session->userauth_kybd_num_prompts > 100) {
+               _libssh2_error(session, LIBSSH2_ERROR_OUT_OF_BOUNDARY,
+                              "Too many replies for "
+                              "keyboard-interactive prompts");
+               goto cleanup;
+            }
 
             if(session->userauth_kybd_num_prompts) {
                 session->userauth_kybd_prompts =
