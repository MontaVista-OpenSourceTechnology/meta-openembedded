From 2af9ae3e8b201a918bfb0c869327fe0b1c0165a7 Mon Sep 17 00:00:00 2001
From: Changqing Li <changqing.li@windriver.com>
Date: Wed, 8 Aug 2018 09:18:27 +0800
Subject: [PATCH] postgresql: Use pkg-config for libxml2 detection.

Upstream-Status: Inappropriate [configuration]

xml2-config does not work. Use pkgconfig to set CPPFLAGS and LIBS.

Signed-off-by: Philip Balister <philip@balister.org>

upate to version 10.4
Signed-off-by: Changqing Li <changqing.li@windriver.com>
---
 configure.in | 28 ++--------------------------
 1 file changed, 2 insertions(+), 26 deletions(-)

diff --git a/configure.in b/configure.in
index 95580ae..902f980 100644
--- a/configure.in
+++ b/configure.in
@@ -856,32 +856,8 @@ AC_MSG_RESULT([$with_libxml])
 AC_SUBST(with_libxml)
 
 if test "$with_libxml" = yes ; then
-  # Check pkg-config, then xml2-config.  But for backwards compatibility,
-  # setting XML2_CONFIG overrides pkg-config.
-  AC_ARG_VAR(XML2_CONFIG, [path to xml2-config utility])dnl
-  have_libxml2_pkg_config=no
-  if test -z "$XML2_CONFIG" -a -n "$PKG_CONFIG"; then
-    PKG_CHECK_MODULES(XML2, [libxml-2.0 >= 2.6.23],
-                      [have_libxml2_pkg_config=yes], [# do nothing])
-  fi
-  if test "$have_libxml2_pkg_config" = no ; then
-    PGAC_PATH_PROGS(XML2_CONFIG, xml2-config)
-    if test -n "$XML2_CONFIG"; then
-      XML2_CFLAGS=`$XML2_CONFIG --cflags`
-      XML2_LIBS=`$XML2_CONFIG --libs`
-    fi
-  fi
-  # Note the user could also set XML2_CFLAGS/XML2_LIBS directly
-  for pgac_option in $XML2_CFLAGS; do
-    case $pgac_option in
-      -I*|-D*) CPPFLAGS="$CPPFLAGS $pgac_option";;
-    esac
-  done
-  for pgac_option in $XML2_LIBS; do
-    case $pgac_option in
-      -L*) LDFLAGS="$LDFLAGS $pgac_option";;
-    esac
-  done
+    CPPFLAGS="$CPPFLAGS `pkg-config --short-errors --print-errors --cflags "libxml-2.0" 2>&1`"
+    LIBS="`pkg-config --short-errors --print-errors --libs "libxml-2.0" 2>&1` $LIBS"
 fi
 
 
-- 
2.7.4

