From bb31031343cf3da50280de1979c0b27daf9bdd71 Mon Sep 17 00:00:00 2001
From: Milan Shah <mshah@mvista.com>
Date: Fri, 29 Oct 2021 17:35:28 +0530
Subject: [PATCH 3/4] mod_session: save one apr_strtok() in
 session_identity_decode().

When the encoding is invalid (missing '='), no need to parse further.

Upstream-status: Backport
CVE: CVE-2021-26690
Signed-off-by: Milan Shah <mshah@mvista.com>
---
 modules/session/mod_session.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/modules/session/mod_session.c b/modules/session/mod_session.c
index a58f614..c44409e 100644
--- a/modules/session/mod_session.c
+++ b/modules/session/mod_session.c
@@ -391,8 +391,8 @@ static apr_status_t session_identity_decode(request_rec * r, session_rec * z)
         char *plast = NULL;
         const char *psep = "=";
         char *key = apr_strtok(pair, psep, &plast);
-        char *val = apr_strtok(NULL, psep, &plast);
         if (key && *key) {
+	    char *val = apr_strtok(NULL, sep, &plast);
             if (!val || !*val) {
                 apr_table_unset(z->entries, key);
             }
-- 
2.7.4

