From f265c8b1eac3271218c2765ab72a55198a3d60bb Mon Sep 17 00:00:00 2001
From: Hitendra Prajapati <hprajapati@mvista.com>
Date: Fri, 7 Jan 2022 10:10:57 +0530
Subject: [PATCH] CVE-2021-44790

Upstream-Status: Backport from https://svn.apache.org/viewvc?view=revision&revision=1896039

Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 modules/lua/lua_request.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/modules/lua/lua_request.c b/modules/lua/lua_request.c
index f9f9ae6..b24594c 100644
--- a/modules/lua/lua_request.c
+++ b/modules/lua/lua_request.c
@@ -376,6 +376,7 @@ static int req_parsebody(lua_State *L)
             if (end == NULL) break;
             key = (char *) apr_pcalloc(r->pool, 256);
             filename = (char *) apr_pcalloc(r->pool, 256);
+	    if (end - crlf <= 8) break;
             vlen = end - crlf - 8;
             buffer = (char *) apr_pcalloc(r->pool, vlen+1);
             memcpy(buffer, crlf + 4, vlen);
-- 
2.25.1

